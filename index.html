<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ClipShortener — Server Split</title>
  <style>
    :root{--bg:#0b0f17;--card:rgba(255,255,255,.03);--text:#e5e7eb;--muted:#9ca3af;--line:#243042}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{width:min(900px,92vw);margin:0 auto;padding:18px 0}
    .card{border:1px solid var(--line);border-radius:16px;padding:16px;background:var(--card)}
    label{display:block;margin-top:12px;font-size:12px;color:var(--muted)}
    input,select,button{width:100%;margin-top:6px;padding:12px;border-radius:12px;border:1px solid var(--line);background:transparent;color:var(--text);font-size:16px}
    button{background:var(--text);color:#0b0f17;font-weight:800;border:none;cursor:pointer}
    button:disabled{opacity:.55;cursor:not-allowed}
    .log{margin-top:12px;padding:12px;border:1px solid var(--line);border-radius:12px;white-space:pre-wrap;color:var(--muted)}
    a{display:block;margin-top:10px;padding:10px;border:1px solid var(--line);border-radius:12px;text-decoration:none;color:var(--text)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2 style="margin:0 0 8px">ClipShortener</h2>
      <div class="log" id="status">Status: page loaded.</div>

      <label>Backend API</label>
      <input id="api" value="https://mrayz-clipshortener-api.hf.space" />

      <label>Upload MP4</label>
      <input id="file" type="file" accept="video/*" />

      <label>Clip length</label>
      <select id="length">
        <option value="15">15 seconds</option>
        <option value="30" selected>30 seconds</option>
        <option value="60">60 seconds</option>
        <option value="300">5 minutes</option>
        <option value="900">15 minutes (max)</option>
      </select>

      <label>Mode</label>
      <select id="mode">
        <option value="fast" selected>fast</option>
        <option value="accurate">accurate</option>
      </select>

      <button id="split" disabled>Split video</button>

      <div class="log" id="debug">Debug:\n</div>
      <div id="downloads"></div>
    </div>
  </div>

  <script>
    const statusEl = document.getElementById("status");
    const debugEl = document.getElementById("debug");
    const apiEl = document.getElementById("api");
    const fileEl = document.getElementById("file");
    const lengthEl = document.getElementById("length");
    const modeEl = document.getElementById("mode");
    const splitBtn = document.getElementById("split");
    const downloadsEl = document.getElementById("downloads");

    function log(msg){ debugEl.textContent += msg + "\n"; }
    function setStatus(msg){ statusEl.textContent = msg; log("[STATUS] " + msg); }

    let selectedFile = null;

    fileEl.addEventListener("change", () => {
      selectedFile = fileEl.files && fileEl.files[0] ? fileEl.files[0] : null;
      splitBtn.disabled = !selectedFile;
      setStatus(selectedFile ? ("Ready: " + selectedFile.name) : "Status: no file selected.");
    });

    splitBtn.addEventListener("click", async () => {
      if (!selectedFile) return;

      downloadsEl.innerHTML = "";
      splitBtn.disabled = true;

      const API_BASE = apiEl.value.trim().replace(/\/+$/, "");
      const segmentTime = parseInt(lengthEl.value || "30", 10);
      const modeVal = modeEl.value || "fast";

      try {
        setStatus("Uploading to server…");

        const form = new FormData();
        form.append("file", selectedFile);

        const res = await fetch(`${API_BASE}/split?segment_seconds=${segmentTime}&mode=${modeVal}`, {
          method: "POST",
          body: form
        });

        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(data.error || ("HTTP " + res.status));

        setStatus("Done. Clips ready.");

        (data.clips || []).forEach(name => {
          const a = document.createElement("a");
          a.href = `${API_BASE}/download/${name}`;
          a.textContent = "Download " + name;
          downloadsEl.appendChild(a);
        });

        if (!data.clips || !data.clips.length) {
          setStatus("Server returned no clips (try smaller file / different mode).");
        }

      } catch (e) {
        setStatus("Error: " + (e.message || String(e)));
      } finally {
        splitBtn.disabled = false;
      }
    });

    setStatus("Status: page loaded. Select a video.");
  </script>
</body>
</html>
