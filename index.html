<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ClipShortener — Social Video Splitter</title>

<style>
body{margin:0;font-family:system-ui;background:#0b0f17;color:#e5e7eb}
.wrap{max-width:900px;margin:auto;padding:20px}
.card{border:1px solid #243042;border-radius:16px;padding:16px;background:rgba(255,255,255,.03)}
h1{margin:0 0 6px}
p{color:#9ca3af}
label{font-size:12px;color:#9ca3af;margin-top:10px;display:block}
input,select,button{
  width:100%;
  margin-top:6px;
  padding:12px;
  border-radius:12px;
  border:1px solid #243042;
  background:#0b0f17;
  color:#e5e7eb;
}
select option {
  background:#0b0f17;
  color:#e5e7eb;
}
button{background:#e5e7eb;color:#0b0f17;font-weight:800;border:none;cursor:pointer}
button:disabled{opacity:.5}
.row{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:800px){.row{grid-template-columns:1fr 1fr}}
.log{white-space:pre-wrap;background:rgba(0,0,0,.25);border:1px solid #243042;border-radius:12px;padding:10px;font-size:13px;color:#9ca3af}
.list a{display:block;margin-top:8px;padding:10px;border:1px solid #243042;border-radius:12px;text-decoration:none;color:#e5e7eb}
.small{font-size:12px;color:#9ca3af}
</style>
</head>

<body>
<div class="wrap">
<div class="card">
<h1>ClipShortener</h1>
<p>Upload a video → split into social-ready clips → download.</p>

<div class="row">
<div>
<label>1) Upload video</label>
<input id="file" type="file" accept="video/*">

<label>2) Clip length</label>
<select id="length">
<option value="15">15 seconds</option>
<option value="30">30 seconds</option>
<option value="60" selected>60 seconds</option>
<option value="300">5 minutes</option>
<option value="900">15 minutes (max)</option>
</select>

<label>3) Cut mode</label>
<select id="mode">
<option value="fast">Fast</option>
<option value="accurate" selected>Accurate (recommended)</option>
</select>

<label>4) Quality</label>
<select id="quality">
<option value="social">Social (smallest)</option>
<option value="balanced" selected>Balanced</option>
<option value="high">High</option>
</select>

<label>5) Format</label>
<select id="format">
<option value="auto">Auto</option>
<option value="vertical" selected>Vertical 9:16</option>
<option value="horizontal">Horizontal 16:9</option>
</select>

<button id="start" disabled>Split video</button>

<div id="limit" class="small"></div>
<div id="status" class="log">Waiting for video.</div>
</div>

<div>
<label>Downloads</label>
<div id="downloads" class="list"></div>
<button id="zip" disabled>Download all as ZIP</button>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script type="module">
import { createFFmpeg, fetchFile } from "https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/ffmpeg.min.js";

const CREATOR_KEY="MOMORE_FREE";
const MAX_RUNS=3;
const params=new URLSearchParams(location.search);
const isCreator=params.get("key")===CREATOR_KEY;
let runs=0;

const fileEl=document.getElementById("file");
const startBtn=document.getElementById("start");
const statusEl=document.getElementById("status");
const limitEl=document.getElementById("limit");
const downloadsEl=document.getElementById("downloads");
const zipBtn=document.getElementById("zip");

let outputs=[];
let selectedFile=null;

function updateLimit(){
if(isCreator){limitEl.textContent="Creator mode: unlimited";}
else limitEl.textContent=`Free runs left: ${Math.max(0,MAX_RUNS-runs)}`;
}
updateLimit();

fileEl.onchange=()=>{
selectedFile=fileEl.files[0];
startBtn.disabled=!selectedFile;
statusEl.textContent=selectedFile?`Ready: ${selectedFile.name}`:"Waiting for video.";
};

const ffmpeg=createFFmpeg({corePath:"https://unpkg.com/@ffmpeg/core@0.12.6/dist/ffmpeg-core.js"});

startBtn.onclick=async()=>{
if(!selectedFile)return;
if(!isCreator && runs++>=MAX_RUNS){statusEl.textContent="Free limit reached.";updateLimit();return;}
updateLimit();

startBtn.disabled=true;
outputs=[];downloadsEl.innerHTML="";zipBtn.disabled=true;
statusEl.textContent="Loading engine…";

await ffmpeg.load();
ffmpeg.FS("writeFile","in.mp4",await fetchFile(selectedFile));

const segment=Math.min(+length.value,900);
const modeVal=mode.value;
const qualityVal=quality.value;
const formatVal=format.value;

let crf=28,scale="1280:-2",ab="96k";
if(qualityVal==="social"){crf=30;scale="854:-2";ab="64k";}
if(qualityVal==="high"){crf=24;scale="1920:-2";ab="128k";}

let vf=formatVal==="auto"?`scale=${scale}`:
`scale=${scale}:force_original_aspect_ratio=increase,crop=${scale.split(":")[0]}:${formatVal==="vertical"?Math.round(scale.split(":")[0]*16/9):Math.round(scale.split(":")[0]*9/16)}`;

statusEl.textContent="Splitting video…";

if(modeVal==="fast"){
await ffmpeg.run("-i","in.mp4","-c","copy","-f","segment","-segment_time",String(segment),"-reset_timestamps","1","out_%03d.mp4");
}else{
await ffmpeg.run("-i","in.mp4","-vf",vf,"-c:v","libx264","-preset","veryfast","-crf",String(crf),"-c:a","aac","-b:a",ab,"-f","segment","-segment_time",String(segment),"-reset_timestamps","1","out_%03d.mp4");
}

const files=ffmpeg.FS("readdir","/").filter(f=>f.startsWith("out_"));
files.forEach((f,i)=>{
const data=ffmpeg.FS("readFile",f);
const blob=new Blob([data.buffer],{type:"video/mp4"});
const url=URL.createObjectURL(blob);
const a=document.createElement("a");
a.href=url;a.download=`clip_${i+1}.mp4`;a.textContent=a.download;
downloadsEl.appendChild(a);
outputs.push({name:a.download,data});
});

zipBtn.disabled=false;
statusEl.textContent=`Done. ${files.length} clips created.`;
startBtn.disabled=false;
};

zipBtn.onclick=async()=>{
const zip=new JSZip();
outputs.forEach(o=>zip.file(o.name,o.data));
const blob=await zip.generateAsync({type:"blob"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="clips.zip";
a.click();
};
</script>
</body>
  </html>
